#pragma once
#include "arlib.h"

typedef struct _GtkScrolledWindow GtkScrolledWindow;
typedef struct _GtkListStore GtkListStore;
typedef struct _GtkTreeView GtkTreeView;
typedef struct _GtkWidget GtkWidget;

class userview : nocopy {
	GtkTreeView* view;
	GtkScrolledWindow* scrollview;
	
	function<void(cstring name)> activate_cb;
	
public:
	static userview* create();
	userview();
	
	class data {
		friend class userview;
	private:
		GtkListStore* store;
		map<string, GtkTreeRowReference*> members; // for remove(), GtkListStore has no search function
	public:
		data();
		void add(cstring name);
		void remove(cstring name);
		
		bool contains(cstring name) { return members.contains(name); }
		
		auto begin() -> decltype(members.keys().begin()) { return members.keys().begin(); }
		auto end()   -> decltype(members.keys().end())   { return members.keys().end();   }
		
		~data();
	};
	
	void bind(data& dat);
	void onactivate(function<void(cstring name)> cb) { activate_cb = cb; }
	
	GtkWidget* gtkwidget() { return (GtkWidget*)scrollview; }
};
